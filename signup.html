<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Registrati — TRAPPERREO</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
:root{--accent:#8b5cf6;--bg:#000;--text:#fff}
*{box-sizing:border-box;margin:0;padding:0}
body{min-height:100vh;display:grid;place-items:center;background:#000;color:#fff;font-family:'Inter',system-ui,Segoe UI,Roboto,Arial}
.card{width:min(92%,440px);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:26px}
h1{font-size:28px;font-weight:900;margin-bottom:6px}
.muted{opacity:.8;margin-bottom:18px}
label{font-size:13px;opacity:.8}
input{width:100%;margin-top:6px;margin-bottom:14px;padding:12px;border:none;border-radius:10px;background:#0f0f10;color:#fff}
.btn{width:100%;padding:12px 16px;border:none;border-radius:10px;background:var(--accent);color:#000;font-weight:900;cursor:pointer}
.error{display:none;margin-bottom:12px;background:#2a0e0e;border:1px solid #ff6b6b;color:#ffdede;padding:10px;border-radius:10px}
.small{font-size:13px;opacity:.8}
</style>
</head>
<body>
<div class="card">
  <h1>Registrati</h1>
  <p class="muted">Crea il tuo account per acquistare i biglietti.</p>
  <div id="err" class="error"></div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
    <div><label>Nome</label><input id="firstName" type="text" placeholder="Mario" required></div>
    <div><label>Cognome</label><input id="lastName" type="text" placeholder="Rossi" required></div>
  </div>

  <label>Data di nascita</label><input id="dob" type="date" required>
  <label>Email</label><input id="email" type="email" placeholder="tuo@email.it" required>
  <label>Password</label><input id="password" type="password" placeholder="Minimo 6 caratteri" required>

  <button id="signUpBtn" class="btn" type="button">Crea account</button>

  <div class="small" style="margin-top:12px">Hai già un account? <a href="/login.html">Accedi</a> • <a href="/index.html">Torna al sito</a></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, setPersistence, browserLocalPersistence, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
const firebaseConfig={apiKey:"AIzaSyDF6BiYXreDirGnT3RPkGwDNlwj5ploUyo",authDomain:"trappereo.firebaseapp.com",projectId:"trappereo",storageBucket:"trappereo.firebasestorage.app",messagingSenderId:"767231932063",appId:"1:767231932063:web:b1431de1c04bbe5dc0d4aa",measurementId:"G-BDBRZQ6J8S"};
const app=initializeApp(firebaseConfig); const auth=getAuth(app); await setPersistence(auth, browserLocalPersistence);
const $=s=>document.querySelector(s);
const calcAge=(d)=>{const x=new Date(d),t=new Date();let a=t.getFullYear()-x.getFullYear();const m=t.getMonth()-x.getMonth();if(m<0||(m===0&&t.getDate()<x.getDate()))a--;return a};
function showErr(msg){const e=$('#err'); e.textContent=msg; e.style.display='block';}
document.getElementById('signUpBtn').addEventListener('click', async (e)=>{
  e.preventDefault(); $('#err').style.display='none';
  try{
    const first=$('#firstName').value.trim(), last=$('#lastName').value.trim(), dob=$('#dob').value, email=$('#email').value.trim(), pwd=$('#password').value;
    if(!first || !last) throw Error("Inserisci nome e cognome.");
    if(!dob) throw Error("Inserisci la data di nascita.");
    if(calcAge(dob) < 16) throw Error("Età minima 16 anni.");
    const cred=await createUserWithEmailAndPassword(auth, email, pwd);
    await updateProfile(cred.user,{displayName:`${first} ${last}`});
    localStorage.setItem(`trapperreo_profile_${cred.user.uid}`, JSON.stringify({dob}));
    location.assign("/checkout.html");
  }catch(err){ showErr(err.message || "Errore imprevisto"); }
});
if(new URLSearchParams(location.search).has('debug')){ console.log('FIREBASE_INIT_OK', !!app, !!auth); }
</script>
</body>
</html>
